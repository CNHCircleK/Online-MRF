<div id="cerf-header">
	<div id="cerf-actions">
		<a mat-icon-button (click)="goBack()">
			<mat-icon>arrow_back</mat-icon>
		</a>

		<p>Cerf ID: {{ cerf._id }}</p>

		<!-- <button *ngFor="let buttonColor of buttonColors" [disabled]="pendingAction || cerf.status==2" mat-mini-fab [class.activeColor]="color==buttonColor" [style.background-color]="buttonColor" (click)="setColor(buttonColor)"></button> -->
<!-- 		<button mat-mini-fab [class.activeColor]="color=='blue'" style="background-color: blue" (click)="setColor('blue')"></button>
		<button mat-mini-fab [class.activeColor]="color=='red'" style="background-color: red" (click)="setColor('red')"></button>
		<button mat-mini-fab [class.activeColor]="color=='orange'" style="background-color: orange" (click)="setColor('orange')"></button>
		<button mat-mini-fab [class.activeColor]="color=='green'" style="background-color: green" (click)="setColor('green')"></button> -->

		<button mat-icon-button (click)="deleteCerf()" [disabled]="pendingAction || cerf.status>=1" matTooltip="Already submitted" [matTooltipDisabled]="cerf.status == 0">
			<mat-icon>delete_outline</mat-icon>
		</button>

		<!-- <button *ngIf="cerf.status==1" mat-raised-button (click)="approveCerf()">	CHANGED data.status to just status, removed mrfView
			Approve
		</button> -->

		<button mat-raised-button [disabled]="!myForm.dirty || !myForm.valid || pendingAction" (click)="saveCerf()">Save</button>
		<button mat-raised-button *ngIf="cerf._id=='new' || cerf.status==0" [disabled]="!myForm.pristine || !myForm.valid || pendingAction" (click)="submitCerf()">Submit</button>
		<span *ngIf="cerf.status>=1 && cerf.author_id == user._id" matTooltip="Already approved" [matTooltipDisabled]="cerf.status != 2">
			<button mat-raised-button  [disabled]="pendingAction || cerf.status==2" (click)="unsubmitCerf()">Unsubmit</button>
		</span>
		<button mat-raised-button *ngIf="cerf.status==1 && user.access.club==2" [disabled]="pendingAction" (click)="approveCerf()">Approve</button>
		<button mat-raised-button *ngIf="cerf.status==2 && user.access.club==2" [disabled]="pendingAction" (click)="unapproveCerf()">Unapprove</button>
		<mat-spinner *ngIf="pendingAction" diameter="36"></mat-spinner>
	</div>

</div>



<mat-divider></mat-divider>
<nav id="cerf-tabs">
	<ul>
		<li [class.mat-elevation-z4]="currentTab=='main'">
			<button mat-icon-button style="color: green" (click)="currentTab='main'">
				<mat-icon matTooltip="Main">description</mat-icon>
			</button>
		</li>
		<li [class.mat-elevation-z4]="currentTab=='attendance'">
			<button mat-icon-button (click)="currentTab='attendance'">
				<mat-icon matTooltip="Attendance">person_outline</mat-icon>
			</button>
		</li>
		<li [class.mat-elevation-z4]="currentTab=='fundraising'">
			<button mat-icon-button style="color: green" (click)="currentTab='fundraising'">
				<mat-icon matTooltip="Fundraising">attach_money</mat-icon>
			</button>
		</li>
		<li [class.mat-elevation-z4]="currentTab=='drivers'">
			<button mat-icon-button style="color: red" (click)="currentTab='drivers'">
				<mat-icon matTooltip="Drivers">drive_eta</mat-icon>
			</button>
		</li>
		<li [class.mat-elevation-z4]="currentTab=='commentary'">
			<button mat-icon-button style="color: blue" (click)="currentTab='commentary'">
				<mat-icon matTooltip="Commentary">comment</mat-icon>
			</button>
		</li>
		<li [class.mat-elevation-z4]="currentTab=='categories'">
			<button mat-icon-button (click)="currentTab='categories'">
				<mat-icon matTooltip="Categories">search</mat-icon>
			</button>
		</li>
		</ul>
	</nav>

	<!-- <br/> -->

<form [formGroup]="myForm">

	<div id="main" *ngIf="currentTab=='main'">
		<h3>Main</h3>
		<!-- <mat-form-field>
			<mat-label>ID</mat-label>
			<input matInput formControlName="_id" readonly>
		</mat-form-field> -->

		<mat-form-field>
			<mat-label>Event Name</mat-label>
			<input matInput formControlName="name" required>
			<!-- <button mat-icon-button matSuffix *ngIf="comment" matTooltip="{{comment}}">
				<mat-icon>chat_bubble</mat-icon>
			</button> -->
			<mat-error>Required</mat-error>
		</mat-form-field>
		<mat-form-field>
			<mat-label>Event Chair</mat-label>
			<input matInput formControlName="chair_id" readonly>
			<!-- <button mat-icon-button matSuffix *ngIf="comment" matTooltip="{{comment}}">
				<mat-icon>chat_bubble</mat-icon>
			</button> -->
			<mat-error>Required</mat-error>
		</mat-form-field>
		<mat-form-field>
			<mat-label>Person Filling out CERF</mat-label>
			<input matInput formControlName="chair_id" readonly>
			<!-- <button mat-icon-button matSuffix *ngIf="comment" matTooltip="{{comment}}">
				<mat-icon>chat_bubble</mat-icon>
			</button> -->
			<mat-error>Required</mat-error>
		</mat-form-field>
		<br/>

		<mat-form-field>
			<mat-label>Location</mat-label>
			<input matInput>
			<!-- <button mat-icon-button matSuffix *ngIf="comment" matTooltip="{{comment}}">
				<mat-icon>chat_bubble</mat-icon>
			</button> -->
		</mat-form-field>
		<mat-form-field>
			<mat-label>Contact Information</mat-label>
			<input matInput>
			<!-- <button mat-icon-button matSuffix *ngIf="comment" matTooltip="{{comment}}">
				<mat-icon>chat_bubble</mat-icon>
			</button> -->
		</mat-form-field>

		<br/>

		<ng-container formGroupName="time">
			<mat-form-field>
				<mat-label>Start Time</mat-label>
				<input matInput [matDatepicker]="start" formControlName="start">
				<mat-datepicker-toggle matSuffix [for]="start"></mat-datepicker-toggle>
				<mat-datepicker type="datetime" #start></mat-datepicker>
				<mat-error>Invalid Time format</mat-error>
			</mat-form-field>

			<mat-form-field>
				<mat-label>End Time</mat-label>
				<input matInput [matDatepicker]="end" formControlName="end">
				<mat-datepicker-toggle matSuffix [for]="end"></mat-datepicker-toggle>
				<mat-datepicker type="datetime" #end></mat-datepicker>
				<mat-error>Invalid Time format</mat-error>
			</mat-form-field>
		</ng-container>

		<br/>

		<ng-container formGroupName="tags">
			<mat-form-field *ngFor="let tag of tags; let i=index">
				<mat-label>Tags</mat-label>
				<input matInput [formControlName]="i">
			</mat-form-field>
		</ng-container>


		<!-- <p>Labels</p>
		<button mat-raised-button [disabled]="myForm.disabled" (click)="addLabel()">Add Label</button>
		<div id="labels" formArrayName="labels">
			<ng-container *ngFor="let label of myForm.controls.labels.controls; let i=index">
				<button mat-icon-button (click)="removeLabel(i)"> <mat-icon>cancel</mat-icon> </button>
				<mat-form-field>
					<input matInput [disabled]="myForm.disabled" [formControlName]="i">
				</mat-form-field>
			</ng-container>
		</div> -->

		<p>Tags <a mat-icon-button (click)="openTagHelp()"><mat-icon [inline]="true">help</mat-icon></a></p>
		<div id="tags">
			<mat-checkbox *ngFor="let tag of tagOptions; let i=index" [checked]="cerf.tags.includes(tag)" [disabled]="myForm.disabled" (change)="addRemoveTag(tag, $event.checked)">{{ tagNames[i] }}</mat-checkbox>
		</div>

	</div>

	<div id="attendance" *ngIf="currentTab=='attendance'">

		<h3>Attendance</h3>

		<ng-container formGroupName="hoursPerAttendee">
			<mat-form-field>
				<mat-label>Default Service Hours</mat-label>
				<input matInput formControlName="service">
			</mat-form-field>

			<mat-form-field>
				<mat-label>Default Leadership Hours</mat-label>
				<input matInput formControlName="leadership">
			</mat-form-field>

			<mat-form-field>
				<mat-label>Default Fellowship Hours</mat-label>
				<input matInput formControlName="fellowship">
			</mat-form-field>
		</ng-container>
		<!-- ngFor attendees -->
		<br/>
		<div id="memberTable">
			<mat-table [dataSource]="members" formArrayName="attendees">

				<ng-container matColumnDef="members">
					<mat-header-cell *matHeaderCellDef> Members </mat-header-cell>
					<mat-cell *matCellDef="let member; let i=index" [formGroupName]="i">
						<button mat-icon-button (click)="removeMember(i)"> <mat-icon>cancel</mat-icon> </button>
						<mat-form-field>
							<input matInput formControlName="name" (change)="myForm.markAsTouched()">
						</mat-form-field>
					</mat-cell>
					<mat-footer-cell *matFooterCellDef>
						<button mat-raised-button [disabled]="myForm.disabled" (click)="addMember()">Add Member</button>
					</mat-footer-cell>
				</ng-container>

				<!-- <ng-container matColumnDef="override">
					<mat-header-cell *matHeaderCellDef> </mat-header-cell>
					<mat-cell *matCellDef="let member; let i=index" >
						<button mat-raised-button>Override Hours</button>
					</mat-cell>
				</ng-container> -->
				<ng-container matColumnDef="service">
					<mat-header-cell *matHeaderCellDef> Service </mat-header-cell>
					<mat-cell *matCellDef="let member; let i=index"  [formGroupName]="i">
						<mat-form-field>
							<input matInput formControlName="service">
						</mat-form-field>
					</mat-cell>
					<mat-footer-cell *matFooterCellDef>{{myForm.get('hoursPerAttendee.service').value}}</mat-footer-cell>
				</ng-container>
				<ng-container matColumnDef="leadership">
					<mat-header-cell *matHeaderCellDef> Leadership </mat-header-cell>
					<mat-cell *matCellDef="let member; let i=index"  [formGroupName]="i">
						<mat-form-field>
							<input matInput formControlName="leadership">
						</mat-form-field>
					</mat-cell>
					<mat-footer-cell *matFooterCellDef>{{myForm.get('hoursPerAttendee.leadership').value}}</mat-footer-cell>
				</ng-container>
				<ng-container matColumnDef="fellowship">
					<mat-header-cell *matHeaderCellDef> Fellowship </mat-header-cell>
					<mat-cell *matCellDef="let member; let i=index"  [formGroupName]="i">
						<mat-form-field>
							<input matInput formControlName="fellowship">
						</mat-form-field>
					</mat-cell>
					<mat-footer-cell *matFooterCellDef>{{myForm.get('hoursPerAttendee.fellowship').value}}</mat-footer-cell>
				</ng-container>

				<mat-header-row *matHeaderRowDef="attendanceColumns"></mat-header-row>
				<mat-row *matRowDef="let row; columns: attendanceColumns;"></mat-row>
				<mat-footer-row *matFooterRowDef="attendanceColumns"></mat-footer-row>
			</mat-table>
		</div>
	</div>

	<div id="fundraising" *ngIf="currentTab=='fundraising'" formGroupName="fundraised">

		<h3>Fundraising</h3>

		<mat-form-field>
			<mat-label>PTP</mat-label>
			<input matInput formControlName="ptp">
		</mat-form-field>
		<mat-form-field>
			<mat-label>FA</mat-label>
			<input matInput formControlName="fa">
		</mat-form-field>
		<mat-form-field>
			<mat-label>KFH</mat-label>	<!-- readonly -->
			<input matInput formControlName="kfh">
		</mat-form-field>

	</div>

	<div id="drivers" *ngIf="currentTab=='drivers'" ><!-- formGroupName="drivers" -->

		<h3>Drivers</h3>

		<!-- <mat-form-field>
			<mat-label>KFH</mat-label>	readonly
			<input matInput formControlName="kfh">
		</mat-form-field> -->

	</div>

	<div id="commentary" *ngIf="currentTab=='commentary'" ><!-- formGroupName="commentary" -->

		<h3>Commentary</h3>

		<!-- <mat-form-field>
			<mat-label>KFH</mat-label>	readonly
			<input matInput formControlName="kfh">
		</mat-form-field> -->

	</div>

	<div id="categories" *ngIf="currentTab=='categories'" ><!-- formArrayName="categories" -->

		<h3>Categories</h3>
		<p>(for your own cataloging)</p>

		<div id="labels" formArrayName="labels">
			<!-- <ng-container *ngFor="let label of myForm.controls.labels.controls; let i=index"> -->
			<div *ngFor="let category of categoryButtons; let i=index">
				<button mat-button class="categoryButton" (click)="toggleLabel(category)" [ngClass]="{'mat-elevation-z4': !isLabelActive(category), 'activeCategory': isLabelActive(category)}">{{category}}</button>
				<button mat-icon-button class="deleteCategory" (click)="removeLabel(i)"> <mat-icon>cancel</mat-icon> </button>
			</div>
		</div>
		<button mat-button *ngIf="!addingCategory" [disabled]="myForm.disabled" (click)="addingCategory=true">+ Add Category</button>
		<form *ngIf="addingCategory">
			<mat-form-field *ngIf="addingCategory" (keyup.enter)="newLabel(newCategory.value)">
				<input matInput #newCategory>
				<mat-icon matSuffix (click)="newLabel(newCategory.value)">arrow_forward</mat-icon>
				<mat-icon matSuffix (click)="addingCategory=false">cancel</mat-icon>
			</mat-form-field>
		</form>

		<!-- <mat-form-field>
			<mat-label>KFH</mat-label>	readonly
			<input matInput formControlName="kfh">
		</mat-form-field> -->

	</div>

</form>